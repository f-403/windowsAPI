å·²ä¸ºä½ é‡æ–°ç”Ÿæˆå®Œæ•´è¯¦ç»†çš„ Windows æ–‡ä»¶ API Markdown æ–‡æ¡£ï¼ŒåŒ…å«ä¸­æ–‡è¯´æ˜ã€ç¤ºä¾‹ä»£ç ï¼ˆå«è¾“å‡ºæ³¨é‡Šï¼‰ã€å¸¦æœ‰è·³è½¬çš„ç›®å½•ä»¥åŠå®˜æ–¹ MSDN é“¾æ¥ã€‚ä½ å¯ä»¥ç›´æ¥å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š

# Windows æ–‡ä»¶ API å‡½æ•°æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å¸¸ç”¨çš„ Windows æ–‡ä»¶ç›¸å…³ API å‡½æ•°ï¼ŒåŒ…æ‹¬å‡½æ•°åŠŸèƒ½è¯´æ˜ã€å‚æ•°è§£æã€ç¤ºä¾‹ä»£ç ï¼ˆå¸¦è¾“å‡ºè¯´æ˜ï¼‰ä»¥åŠå®˜æ–¹ MSDN é“¾æ¥ï¼Œæ–¹ä¾¿å­¦ä¹ å’ŒæŸ¥é˜…ã€‚

---

## ğŸ“‘ ç›®å½•

0. [GetFileInformationByHandleEx - è·å–æ‰©å±•çš„æ–‡ä»¶ä¿¡æ¯](#0-getfileinformationbyhandleex---è·å–æ‰©å±•çš„æ–‡ä»¶ä¿¡æ¯)
1. [GetFullPathName - è·å–å®Œæ•´è·¯å¾„å](#1-getfullpathname---è·å–å®Œæ•´è·¯å¾„å)
2. [SetFileShortName - è®¾ç½®æ–‡ä»¶çŸ­åç§°](#2-setfileshortname---è®¾ç½®æ–‡ä»¶çŸ­åç§°)
3. [FindFirstFile - æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…æ–‡ä»¶](#3-findfirstfile---æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…æ–‡ä»¶)
4. [FindNextFile - æŸ¥æ‰¾ä¸‹ä¸€ä¸ªæ–‡ä»¶](#4-findnextfile---æŸ¥æ‰¾ä¸‹ä¸€ä¸ªæ–‡ä»¶)
5. [GetFileTime - è·å–æ–‡ä»¶æ—¶é—´](#5-getfiletime---è·å–æ–‡ä»¶æ—¶é—´)
6. [GetFileType - è·å–æ–‡ä»¶ç±»å‹](#6-getfiletype---è·å–æ–‡ä»¶ç±»å‹)
7. [GetFileAttributes - è·å–æ–‡ä»¶å±æ€§](#7-getfileattributes---è·å–æ–‡ä»¶å±æ€§)
8. [GetTempFileName - ç”Ÿæˆä¸´æ—¶æ–‡ä»¶å](#8-gettempfilename---ç”Ÿæˆä¸´æ—¶æ–‡ä»¶å)
9. [GetSystemTimeAsFileTime - è·å–ç³»ç»Ÿæ—¶é—´](#9-getsystemtimeasfiletime---è·å–ç³»ç»Ÿæ—¶é—´)
10. [FileTimeToSystemTime - æ–‡ä»¶æ—¶é—´è½¬ç³»ç»Ÿæ—¶é—´](#10-filetimetosystemtime---æ–‡ä»¶æ—¶é—´è½¬ç³»ç»Ÿæ—¶é—´)
11. [SystemTimeToFileTime - ç³»ç»Ÿæ—¶é—´è½¬æ–‡ä»¶æ—¶é—´](#11-systemtimetofiletime---ç³»ç»Ÿæ—¶é—´è½¬æ–‡ä»¶æ—¶é—´)
12. [CompareFileTime - æ¯”è¾ƒæ–‡ä»¶æ—¶é—´](#12-comparefiletime---æ¯”è¾ƒæ–‡ä»¶æ—¶é—´)
13. [SetFileTime - è®¾ç½®æ–‡ä»¶æ—¶é—´](#13-setfiletime---è®¾ç½®æ–‡ä»¶æ—¶é—´)
14. [FileTimeToLocalFileTime - æ–‡ä»¶æ—¶é—´è½¬æœ¬åœ°æ—¶é—´](#14-filetimetolocalfiletime---æ–‡ä»¶æ—¶é—´è½¬æœ¬åœ°æ—¶é—´)
15. [LocalFileTimeToFileTime - æœ¬åœ°æ—¶é—´è½¬æ–‡ä»¶æ—¶é—´](#15-localfiletimetofiletime---æœ¬åœ°æ—¶é—´è½¬æ–‡ä»¶æ—¶é—´)
16. [LockFileEx - åŠ é”æ–‡ä»¶åŒºåŸŸ](#16-lockfileex---åŠ é”æ–‡ä»¶åŒºåŸŸ)
17. [UnlockFileEx - è§£é”æ–‡ä»¶åŒºåŸŸ](#17-unlockfileex---è§£é”æ–‡ä»¶åŒºåŸŸ)

---

## 0. GetFileInformationByHandleEx - è·å–æ‰©å±•çš„æ–‡ä»¶ä¿¡æ¯

**åŠŸèƒ½**
è·å–æ–‡ä»¶å¥æŸ„ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŸºæœ¬ä¿¡æ¯ã€æ ‡å‡†ä¿¡æ¯ã€åç§°ã€æµä¿¡æ¯ç­‰ã€‚

**å‡½æ•°åŸå‹**

```cpp
BOOL GetFileInformationByHandleEx(
  HANDLE                    hFile,
  FILE_INFO_BY_HANDLE_CLASS FileInformationClass,
  LPVOID                    lpFileInformation,
  DWORD                     dwBufferSize
);
```

**å‚æ•°è¯´æ˜**

* `hFile`ï¼šæ‰“å¼€çš„æ–‡ä»¶å¥æŸ„ã€‚
* `FileInformationClass`ï¼šæŒ‡å®šè¦è·å–çš„ä¿¡æ¯ç±»å‹ï¼Œå¸¸è§å€¼åŒ…æ‹¬ï¼š

  * `FileBasicInfo`
  * `FileStandardInfo`
  * `FileNameInfo`
  * `FileStreamInfo`
* `lpFileInformation`ï¼šæŒ‡å‘æ¥æ”¶ä¿¡æ¯çš„ç¼“å†²åŒºã€‚
* `dwBufferSize`ï¼šç¼“å†²åŒºå¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€‚

**ç¤ºä¾‹ä»£ç ï¼šè·å–æ ‡å‡†æ–‡ä»¶ä¿¡æ¯**

```cpp
#include <windows.h>
#include <winbase.h>
#include <stdio.h>

int main() {
    HANDLE hFile = CreateFileW(L"C:\\test.txt", GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, 0, NULL);
    if (hFile == INVALID_HANDLE_VALUE) {
        wprintf(L"æ‰“å¼€æ–‡ä»¶å¤±è´¥\n");
        return 1;
    }

    FILE_STANDARD_INFO standardInfo;
    if (GetFileInformationByHandleEx(hFile, FileStandardInfo, &standardInfo, sizeof(standardInfo))) {
        wprintf(L"æ–‡ä»¶å¤§å°: %lld å­—èŠ‚\n", standardInfo.EndOfFile.QuadPart);
        wprintf(L"åˆ†é…å¤§å°: %lld å­—èŠ‚\n", standardInfo.AllocationSize.QuadPart);
        wprintf(L"æ˜¯å¦ç›®å½•: %s\n", standardInfo.Directory ? L"æ˜¯" : L"å¦");
    } else {
        wprintf(L"è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥\n");
    }

    CloseHandle(hFile);
    return 0;
}
```

**ç¤ºä¾‹è¾“å‡º**

```
æ–‡ä»¶å¤§å°: 1024 å­—èŠ‚
åˆ†é…å¤§å°: 4096 å­—èŠ‚
æ˜¯å¦ç›®å½•: å¦
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-getfileinformationbyhandleex)

## 1. GetFullPathName - è·å–å®Œæ•´è·¯å¾„å

**åŠŸèƒ½**  
è·å–æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„å®Œæ•´è·¯å¾„åã€‚

**å‡½æ•°åŸå‹**  
```cpp
DWORD GetFullPathName(
  LPCWSTR lpFileName,
  DWORD nBufferLength,
  LPWSTR lpBuffer,
  LPWSTR *lpFilePart
);
````

**å‚æ•°è¯´æ˜**

* `lpFileName`ï¼šè¾“å…¥çš„æ–‡ä»¶åæˆ–è·¯å¾„ã€‚
* `nBufferLength`ï¼š`lpBuffer` ç¼“å†²åŒºå¤§å°ã€‚
* `lpBuffer`ï¼šæ¥æ”¶å®Œæ•´è·¯å¾„çš„ç¼“å†²åŒºã€‚
* `lpFilePart`ï¼šæŒ‡å‘æ–‡ä»¶åéƒ¨åˆ†çš„æŒ‡é’ˆã€‚

**ç¤ºä¾‹ä»£ç **

```cpp
wchar_t fullPath[MAX_PATH];
DWORD ret = GetFullPathName(L"..\\test.txt", MAX_PATH, fullPath, nullptr);
if (ret > 0 && ret < MAX_PATH) {
    wprintf(L"å®Œæ•´è·¯å¾„: %ls\n", fullPath);
} else {
    wprintf(L"è·å–å®Œæ•´è·¯å¾„å¤±è´¥\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
å®Œæ•´è·¯å¾„: C:\Users\YourUser\test.txt
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-getfullpathnamew)

---

## 2. SetFileShortName - è®¾ç½®æ–‡ä»¶çŸ­åç§°

**åŠŸèƒ½**
è®¾ç½®æŒ‡å®šæ–‡ä»¶çš„çŸ­æ–‡ä»¶åï¼ˆ8.3 æ ¼å¼åï¼‰ã€‚

**å‡½æ•°åŸå‹**

```cpp
BOOL SetFileShortName(
  HANDLE hFile,
  LPCWSTR lpShortName
);
```

**å‚æ•°è¯´æ˜**

* `hFile`ï¼šæ–‡ä»¶å¥æŸ„ï¼Œå¿…é¡»æœ‰å†™æƒé™ã€‚
* `lpShortName`ï¼šè¦è®¾ç½®çš„çŸ­åç§°ã€‚

**ç¤ºä¾‹ä»£ç **

```cpp
HANDLE hFile = CreateFile(L"C:\\testfile.txt", GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL);
if (hFile != INVALID_HANDLE_VALUE) {
    if (SetFileShortName(hFile, L"TEST.TXT")) {
        wprintf(L"è®¾ç½®çŸ­åç§°æˆåŠŸ\n");
    } else {
        wprintf(L"è®¾ç½®çŸ­åç§°å¤±è´¥\n");
    }
    CloseHandle(hFile);
} else {
    wprintf(L"æ‰“å¼€æ–‡ä»¶å¤±è´¥\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
è®¾ç½®çŸ­åç§°æˆåŠŸ
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-setfileshortnamew)

---

## 3. FindFirstFile - æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…æ–‡ä»¶

**åŠŸèƒ½**
æœç´¢ç¬¦åˆé€šé…ç¬¦æ¨¡å¼çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚

**å‡½æ•°åŸå‹**

```cpp
HANDLE FindFirstFile(
  LPCWSTR lpFileName,
  LPWIN32_FIND_DATA lpFindFileData
);
```

**ç¤ºä¾‹ä»£ç **

```cpp
WIN32_FIND_DATA findData;
HANDLE hFind = FindFirstFile(L"C:\\*.txt", &findData);
if (hFind != INVALID_HANDLE_VALUE) {
    wprintf(L"æ‰¾åˆ°æ–‡ä»¶: %ls\n", findData.cFileName);
    FindClose(hFind);
} else {
    wprintf(L"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…æ–‡ä»¶\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
æ‰¾åˆ°æ–‡ä»¶: example.txt
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-findfirstfilew)

---

## 4. FindNextFile - æŸ¥æ‰¾ä¸‹ä¸€ä¸ªæ–‡ä»¶

**åŠŸèƒ½**
ç»§ç»­æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚

**å‡½æ•°åŸå‹**

```cpp
BOOL FindNextFile(
  HANDLE hFindFile,
  LPWIN32_FIND_DATA lpFindFileData
);
```

**ç¤ºä¾‹ä»£ç **

```cpp
WIN32_FIND_DATA findData;
HANDLE hFind = FindFirstFile(L"C:\\*.txt", &findData);
if (hFind != INVALID_HANDLE_VALUE) {
    do {
        wprintf(L"æ‰¾åˆ°æ–‡ä»¶: %ls\n", findData.cFileName);
    } while (FindNextFile(hFind, &findData));
    FindClose(hFind);
} else {
    wprintf(L"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…æ–‡ä»¶\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
æ‰¾åˆ°æ–‡ä»¶: example.txt
æ‰¾åˆ°æ–‡ä»¶: test.txt
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-findnextfilew)

---

## 5. GetFileTime - è·å–æ–‡ä»¶æ—¶é—´

**åŠŸèƒ½**
è·å–æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´ã€æœ€åè®¿é—®æ—¶é—´å’Œæœ€åå†™å…¥æ—¶é—´ã€‚

**å‡½æ•°åŸå‹**

```cpp
BOOL GetFileTime(
  HANDLE hFile,
  LPFILETIME lpCreationTime,
  LPFILETIME lpLastAccessTime,
  LPFILETIME lpLastWriteTime
);
```

**ç¤ºä¾‹ä»£ç **

```cpp
FILETIME ftCreate, ftAccess, ftWrite;
HANDLE hFile = CreateFile(L"C:\\test.txt", GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, 0, NULL);
if (hFile != INVALID_HANDLE_VALUE) {
    if (GetFileTime(hFile, &ftCreate, &ftAccess, &ftWrite)) {
        wprintf(L"æˆåŠŸè·å–æ–‡ä»¶æ—¶é—´\n");
    } else {
        wprintf(L"è·å–æ–‡ä»¶æ—¶é—´å¤±è´¥\n");
    }
    CloseHandle(hFile);
} else {
    wprintf(L"æ‰“å¼€æ–‡ä»¶å¤±è´¥\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
æˆåŠŸè·å–æ–‡ä»¶æ—¶é—´
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-getfiletime)

---

## 6. GetFileType - è·å–æ–‡ä»¶ç±»å‹

**åŠŸèƒ½**
è¿”å›æ–‡ä»¶å¥æŸ„å¯¹åº”çš„æ–‡ä»¶ç±»å‹ã€‚

**å‡½æ•°åŸå‹**

```cpp
DWORD GetFileType(
  HANDLE hFile
);
```

**ç¤ºä¾‹ä»£ç **

```cpp
HANDLE hFile = CreateFile(L"C:\\test.txt", GENERIC_READ, 0, NULL, OPEN_EXISTING, 0, NULL);
if (hFile != INVALID_HANDLE_VALUE) {
    DWORD type = GetFileType(hFile);
    switch (type) {
        case FILE_TYPE_DISK:
            wprintf(L"æ–‡ä»¶ç±»å‹ï¼šç£ç›˜æ–‡ä»¶\n"); break;
        case FILE_TYPE_CHAR:
            wprintf(L"æ–‡ä»¶ç±»å‹ï¼šå­—ç¬¦è®¾å¤‡\n"); break;
        case FILE_TYPE_PIPE:
            wprintf(L"æ–‡ä»¶ç±»å‹ï¼šç®¡é“\n"); break;
        default:
            wprintf(L"æ–‡ä»¶ç±»å‹ï¼šæœªçŸ¥\n");
    }
    CloseHandle(hFile);
} else {
    wprintf(L"æ‰“å¼€æ–‡ä»¶å¤±è´¥\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
æ–‡ä»¶ç±»å‹ï¼šç£ç›˜æ–‡ä»¶
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-getfiletype)

---

## 7. GetFileAttributes - è·å–æ–‡ä»¶å±æ€§
> æœ‰ä¸ªå¯¹åº”çš„SetFileAttributes()ç”¨äºè®¾ç½®å±æ€§
>
**åŠŸèƒ½**
è·å–æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„å±æ€§ã€‚

**å‡½æ•°åŸå‹**

```cpp
DWORD GetFileAttributes(
  LPCWSTR lpFileName
);
```

**ç¤ºä¾‹ä»£ç **

```cpp
DWORD attr = GetFileAttributes(L"C:\\test.txt");
if (attr != INVALID_FILE_ATTRIBUTES) {
    if (attr & FILE_ATTRIBUTE_READONLY)
        wprintf(L"æ–‡ä»¶æ˜¯åªè¯»çš„\n");
    if (attr & FILE_ATTRIBUTE_HIDDEN)
        wprintf(L"æ–‡ä»¶æ˜¯éšè—çš„\n");
} else {
    wprintf(L"è·å–å±æ€§å¤±è´¥\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
æ–‡ä»¶æ˜¯åªè¯»çš„
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-getfileattributesw)

---

## 8. GetTempFileName - ç”Ÿæˆä¸´æ—¶æ–‡ä»¶å

**åŠŸèƒ½**
ç”Ÿæˆå”¯ä¸€ä¸´æ—¶æ–‡ä»¶åå¹¶åˆ›å»ºç©ºæ–‡ä»¶ã€‚

**å‡½æ•°åŸå‹**

```cpp
UINT GetTempFileName(
  LPCWSTR lpPathName,
  LPCWSTR lpPrefixString,
  UINT uUnique,
  LPWSTR lpTempFileName
);
```

**ç¤ºä¾‹ä»£ç **

```cpp
wchar_t tempPath[MAX_PATH];
wchar_t tempFile[MAX_PATH];
GetTempPath(MAX_PATH, tempPath);
UINT ret = GetTempFileName(tempPath, L"TMP", 0, tempFile);
if (ret != 0) {
    wprintf(L"ä¸´æ—¶æ–‡ä»¶å: %ls\n", tempFile);
} else {
    wprintf(L"ç”Ÿæˆä¸´æ—¶æ–‡ä»¶åå¤±è´¥\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
ä¸´æ—¶æ–‡ä»¶å: C:\Users\YourUser\AppData\Local\Temp\TMP0001.tmp
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-gettempfilenamew)

---

## 9. GetSystemTimeAsFileTime - è·å–ç³»ç»Ÿæ—¶é—´

**åŠŸèƒ½**
è·å–å½“å‰ç³»ç»Ÿæ—¶é—´ï¼ˆUTCï¼‰ï¼Œä»¥ FILETIME ç»“æ„è¿”å›ã€‚

**å‡½æ•°åŸå‹**

```cpp
void GetSystemTimeAsFileTime(
  LPFILETIME lpSystemTimeAsFileTime
);
```

**ç¤ºä¾‹ä»£ç **

```cpp
FILETIME ft;
GetSystemTimeAsFileTime(&ft);
wprintf(L"ç³»ç»Ÿæ—¶é—´ FILETIME: %u-%u\n", ft.dwHighDateTime, ft.dwLowDateTime);
```

**ç¤ºä¾‹è¾“å‡º**

```
ç³»ç»Ÿæ—¶é—´ FILETIME: 3050317400-24750000
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime)

---

## 10. FileTimeToSystemTime - æ–‡ä»¶æ—¶é—´è½¬ç³»ç»Ÿæ—¶é—´

**åŠŸèƒ½**
å°† FILETIME è½¬æ¢ä¸ºå¯è¯»çš„ SYSTEMTIMEã€‚

**å‡½æ•°åŸå‹**

```cpp
BOOL FileTimeToSystemTime(
  const FILETIME *lpFileTime,
  LPSYSTEMTIME lpSystemTime
);
```

**ç¤ºä¾‹ä»£ç **

```cpp
FILETIME ft;
SYSTEMTIME st;
GetSystemTimeAsFileTime(&ft);
if (FileTimeToSystemTime(&ft, &st)) {
    wprintf(L"ç³»ç»Ÿæ—¶é—´: %d-%d-%d %d:%d:%d\n", st.wYear, st.wMonth, st.wDay, st.wHour, st.wMinute, st.wSecond);
} else {
    wprintf(L"è½¬æ¢å¤±è´¥\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
ç³»ç»Ÿæ—¶é—´: 2025-6-26 10:30:15
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/timezoneapi/nf-timezoneapi-filetimetosystemtime)

---

## 11. SystemTimeToFileTime - ç³»ç»Ÿæ—¶é—´è½¬æ–‡ä»¶æ—¶é—´

**åŠŸèƒ½**
å°† SYSTEMTIME è½¬æ¢ä¸º FILETIMEã€‚

**å‡½æ•°åŸå‹**

```cpp
BOOL SystemTimeToFileTime(
  const SYSTEMTIME *lpSystemTime,
  LPFILETIME lpFileTime
);
```

**ç¤ºä¾‹ä»£ç **

```cpp
SYSTEMTIME st = {2025, 6, 0, 26, 10, 30, 0, 0};
FILETIME ft;
if (SystemTimeToFileTime(&st, &ft)) {
    wprintf(L"è½¬æ¢åçš„ FILETIME: %u-%u\n", ft.dwHighDateTime, ft.dwLowDateTime);
} else {
    wprintf(L"è½¬æ¢å¤±è´¥\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
è½¬æ¢åçš„ FILETIME: 3050317400-24750000
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/timezoneapi/nf-timezoneapi-systemtimetofiletime)

---

## 12. CompareFileTime - æ¯”è¾ƒæ–‡ä»¶æ—¶é—´

**åŠŸèƒ½**
æ¯”è¾ƒä¸¤ä¸ª FILETIME å€¼ã€‚

**å‡½æ•°åŸå‹**

```cpp
LONG CompareFileTime(
  const FILETIME *lpFileTime1,
  const FILETIME *lpFileTime2
);
```

**è¿”å›å€¼**

* `<0`ï¼š`lpFileTime1` æ—©äº `lpFileTime2`
* `0` ï¼šä¸¤è€…ç›¸ç­‰
* `>0` ï¼š`lpFileTime1` æ™šäº `lpFileTime2`

**ç¤ºä¾‹ä»£ç **

```cpp
FILETIME ft1, ft2;
GetSystemTimeAsFileTime(&ft1);
Sleep(1000);
GetSystemTimeAsFileTime(&ft2);

LONG cmp = CompareFileTime(&ft1, &ft2);
if (cmp < 0)
    wprintf(L"ft1 æ—©äº ft2\n");
else if (cmp > 0)
    wprintf(L"ft1 æ™šäº ft2\n");
else
    wprintf(L"ft1 ç­‰äº ft2\n");
```

**ç¤ºä¾‹è¾“å‡º**

```
ft1 æ—©äº ft2
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-comparefiletime)

---

## 13. SetFileTime - è®¾ç½®æ–‡ä»¶æ—¶é—´

**åŠŸèƒ½**
è®¾ç½®æ–‡ä»¶çš„åˆ›å»ºã€è®¿é—®ã€ä¿®æ”¹æ—¶é—´ã€‚

**å‡½æ•°åŸå‹**

```cpp
BOOL SetFileTime(
  HANDLE hFile,
  const FILETIME *lpCreationTime,
  const FILETIME *lpLastAccessTime,
  const FILETIME *lpLastWriteTime
);
```

**ç¤ºä¾‹ä»£ç **

```cpp
FILETIME ft;
GetSystemTimeAsFileTime(&ft);
HANDLE hFile = CreateFile(L"C:\\test.txt", GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL);
if (hFile != INVALID_HANDLE_VALUE) {
    if (SetFileTime(hFile, &ft, &ft, &ft)) {
        wprintf(L"è®¾ç½®æ—¶é—´æˆåŠŸ\n");
    } else {
        wprintf(L"è®¾ç½®æ—¶é—´å¤±è´¥\n");
    }
    CloseHandle(hFile);
} else {
    wprintf(L"æ‰“å¼€æ–‡ä»¶å¤±è´¥\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
è®¾ç½®æ—¶é—´æˆåŠŸ
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-setfiletime)

---

## 14. FileTimeToLocalFileTime - æ–‡ä»¶æ—¶é—´è½¬æœ¬åœ°æ—¶é—´

**åŠŸèƒ½**
å°† UTC æ–‡ä»¶æ—¶é—´è½¬æ¢æˆæœ¬åœ°æ—¶é—´ã€‚

**å‡½æ•°åŸå‹**

```cpp
BOOL FileTimeToLocalFileTime(
  const FILETIME *lpFileTime,
  LPFILETIME lpLocalFileTime
);
```

**ç¤ºä¾‹ä»£ç **

```cpp
FILETIME ftUTC, ftLocal;
GetSystemTimeAsFileTime(&ftUTC);
if (FileTimeToLocalFileTime(&ftUTC, &ftLocal)) {
    wprintf(L"æœ¬åœ°æ–‡ä»¶æ—¶é—´: %u-%u\n", ftLocal.dwHighDateTime, ftLocal.dwLowDateTime);
} else

 {
    wprintf(L"è½¬æ¢å¤±è´¥\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
æœ¬åœ°æ–‡ä»¶æ—¶é—´: 3050317400-24750000
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/timezoneapi/nf-timezoneapi-filetimetolocalfiletime)

---

## 15. LocalFileTimeToFileTime - æœ¬åœ°æ—¶é—´è½¬æ–‡ä»¶æ—¶é—´

**åŠŸèƒ½**
å°†æœ¬åœ°æ–‡ä»¶æ—¶é—´è½¬æ¢æˆ UTC æ—¶é—´ã€‚

**å‡½æ•°åŸå‹**

```cpp
BOOL LocalFileTimeToFileTime(
  const FILETIME *lpLocalFileTime,
  LPFILETIME lpFileTime
);
```

**ç¤ºä¾‹ä»£ç **

```cpp
FILETIME ftUTC, ftLocal, ftConvertedBack;
GetSystemTimeAsFileTime(&ftUTC);
FileTimeToLocalFileTime(&ftUTC, &ftLocal);
if (LocalFileTimeToFileTime(&ftLocal, &ftConvertedBack)) {
    wprintf(L"è½¬æ¢å› UTC æ–‡ä»¶æ—¶é—´: %u-%u\n", ftConvertedBack.dwHighDateTime, ftConvertedBack.dwLowDateTime);
} else {
    wprintf(L"è½¬æ¢å¤±è´¥\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
è½¬æ¢å› UTC æ–‡ä»¶æ—¶é—´: 3050317400-24750000
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/timezoneapi/nf-timezoneapi-localfiletimetofiletime)

---

## 16. LockFileEx - åŠ é”æ–‡ä»¶åŒºåŸŸ

**åŠŸèƒ½**
å¯¹æ–‡ä»¶æŒ‡å®šåŒºåŸŸåŠ é”ï¼Œä»¥æ”¯æŒå¤šçº¿ç¨‹æˆ–å¤šè¿›ç¨‹åè°ƒè®¿é—®ã€‚

**å‡½æ•°åŸå‹**

```cpp
BOOL LockFileEx(
  HANDLE       hFile,
  DWORD        dwFlags,
  DWORD        dwReserved,
  DWORD        nNumberOfBytesToLockLow,
  DWORD        nNumberOfBytesToLockHigh,
  LPOVERLAPPED lpOverlapped
);
```

**å‚æ•°è¯´æ˜**

* `hFile`ï¼šæ–‡ä»¶å¥æŸ„ã€‚
* `dwFlags`ï¼šé”å®šé€‰é¡¹ï¼ˆä¾‹å¦‚ `LOCKFILE_EXCLUSIVE_LOCK` è¡¨ç¤ºç‹¬å é”ï¼‰ã€‚
* `nNumberOfBytesToLockLow/High`ï¼šè¦é”å®šçš„å­—èŠ‚æ•°ï¼ˆ64 ä½æ‹†æˆé«˜ä½ä½ï¼‰ã€‚
* `lpOverlapped`ï¼šå¼‚æ­¥ç»“æ„ï¼ŒæŒ‡å®šé”å®šèµ·å§‹åç§»ã€‚

**ç¤ºä¾‹ä»£ç **

```cpp
HANDLE hFile = CreateFile(L"C:\\test.txt", GENERIC_WRITE, 0, NULL, OPEN_EXISTING, FILE_FLAG_OVERLAPPED, NULL);
if (hFile != INVALID_HANDLE_VALUE) {
    OVERLAPPED ov = {0};
    ov.Offset = 0;
    ov.OffsetHigh = 0;
    if (LockFileEx(hFile, LOCKFILE_EXCLUSIVE_LOCK, 0, 100, 0, &ov)) {
        wprintf(L"æ–‡ä»¶åŒºåŸŸåŠ é”æˆåŠŸ\n");
        // æ¨¡æ‹Ÿå¤„ç†
        Sleep(2000);
        UnlockFileEx(hFile, 0, 100, 0, &ov);
    } else {
        wprintf(L"åŠ é”å¤±è´¥\n");
    }
    CloseHandle(hFile);
} else {
    wprintf(L"æ‰“å¼€æ–‡ä»¶å¤±è´¥\n");
}
```

**ç¤ºä¾‹è¾“å‡º**

```
æ–‡ä»¶åŒºåŸŸåŠ é”æˆåŠŸ
```

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-lockfileex)

---

## 17. UnlockFileEx - è§£é”æ–‡ä»¶åŒºåŸŸ

**åŠŸèƒ½**
è§£é”ä¹‹å‰ç”¨ `LockFileEx` é”å®šçš„æ–‡ä»¶åŒºåŸŸã€‚

**å‡½æ•°åŸå‹**

```cpp
BOOL UnlockFileEx(
  HANDLE       hFile,
  DWORD        dwReserved,
  DWORD        nNumberOfBytesToUnlockLow,
  DWORD        nNumberOfBytesToUnlockHigh,
  LPOVERLAPPED lpOverlapped
);
```

**ç¤ºä¾‹ä»£ç **
è§ä¸Šé¢ `LockFileEx` ç¤ºä¾‹ä¸­çš„è§£é”éƒ¨åˆ†ã€‚

[MSDN æ–‡æ¡£](https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-unlockfileex)

---

