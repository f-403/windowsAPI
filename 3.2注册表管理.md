# Windows æ³¨å†Œè¡¨ API ä½¿ç”¨æ–‡æ¡£

> å«ç›®å½•ç´¢å¼•ã€ç®€çŸ­ç¤ºä¾‹ã€è¾“å‡ºè¯´æ˜ã€ä¸­æ–‡æ³¨é‡Šï¼Œé€‚åˆå­¦ä¹ å’Œå‚è€ƒã€‚

---

## ğŸ“‘ ç›®å½•

1. [RegCreateKeyEx - åˆ›å»ºæˆ–æ‰“å¼€æ³¨å†Œè¡¨é”®](#regcreatekeyex)
2. [RegOpenKeyEx - æ‰“å¼€å·²æœ‰æ³¨å†Œè¡¨é”®](#regopenkeyex)
3. [RegEnumKeyEx - æšä¸¾å­é¡¹](#regenumkeyex)
4. [RegEnumValue - æšä¸¾é”®å€¼å](#regenumvalue)
5. [RegSetValueEx - è®¾ç½®é”®å€¼æ•°æ®](#regsetvalueex)
6. [RegQueryValueEx - è¯»å–é”®å€¼æ•°æ®](#regqueryvalueex)
7. [RegDeleteValue - åˆ é™¤é”®å€¼](#regdeletevalue)
8. [RegDeleteKeyEx - åˆ é™¤å­é¡¹](#regdeletekeyex)
9. [RegCloseKey - å…³é—­æ³¨å†Œè¡¨é”®å¥æŸ„](#regclosekey)
10. [RegQueryInfoKeyW - è·å–æ³¨å†Œè¡¨é”®ä¿¡æ¯](#regqueryinfokeyw)

---

## 1. RegCreateKeyEx - åˆ›å»ºæˆ–æ‰“å¼€æ³¨å†Œè¡¨é”®

* ğŸ“š [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regcreatekeyexw)

```cpp
HKEY hKey;
LONG ret = RegCreateKeyExW(
    HKEY_CURRENT_USER,
    L"Software\\MyApp",
    0,
    NULL,
    0,
    KEY_ALL_ACCESS,
    NULL,
    &hKey,
    NULL
);
```

### å‚æ•°è¯´æ˜

* `HKEY_CURRENT_USER`ï¼šæ ¹é”®å¥æŸ„ã€‚
* `L"Software\\MyApp"`ï¼šå­é¡¹è·¯å¾„ã€‚
* `0`ï¼šä¿ç•™å‚æ•°ï¼Œå¿…é¡»ä¸º 0ã€‚
* `NULL`ï¼šç±»åï¼Œä¸€èˆ¬ä¸º NULLã€‚
* `KEY_ALL_ACCESS`ï¼šè®¿é—®æƒé™ï¼Œè¡¨ç¤ºè¯»å†™å®Œå…¨æƒé™ã€‚
* `&hKey`ï¼šè¿”å›çš„é”®å¥æŸ„ã€‚
* `NULL`ï¼šè¿”å›æ˜¯å¦åˆ›å»ºäº†æ–°é”®ï¼Œä¸€èˆ¬å¯å¿½ç•¥ã€‚

### ç¤ºä¾‹è¾“å‡º

```
æ‰“å¼€æˆåŠŸï¼Œè¿”å›å¥æŸ„: hKey
```

---

## 2. RegOpenKeyEx - æ‰“å¼€å·²æœ‰æ³¨å†Œè¡¨é”®

* ğŸ“š [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regopenkeyexw)

```cpp
HKEY hKey;
LONG ret = RegOpenKeyExW(HKEY_CURRENT_USER, L"Software\\MyApp", 0, KEY_READ, &hKey);
```

### å‚æ•°è¯´æ˜

* `HKEY_CURRENT_USER`ï¼šæ ¹é”®å¥æŸ„ã€‚
* `L"Software\\MyApp"`ï¼šè¦æ‰“å¼€çš„å­é¡¹è·¯å¾„ã€‚
* `0`ï¼šä¿ç•™ï¼Œå¿…é¡»ä¸º 0ã€‚
* `KEY_READ`ï¼šåªè¯»æƒé™ã€‚
* `&hKey`ï¼šæ‰“å¼€åè¿”å›çš„å¥æŸ„ã€‚

### è¾“å‡º

```
æ‰“å¼€æˆåŠŸæˆ–å¤±è´¥ï¼Œret=0 è¡¨ç¤ºæˆåŠŸ
```

---

## 3. RegEnumKeyEx - æšä¸¾å­é¡¹

* ğŸ“š [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regenumkeyexw)

```cpp
WCHAR subKey[MAX_PATH];
DWORD len = MAX_PATH;
RegEnumKeyExW(hKey, index, subKey, &len, NULL, NULL, NULL, NULL);
```

### å‚æ•°è¯´æ˜

* `hKey`ï¼šè¦æšä¸¾çš„é”®å¥æŸ„ã€‚
* `index`ï¼šç´¢å¼•ï¼Œä» 0 å¼€å§‹é€’å¢ã€‚
* `subKey`ï¼šæ¥æ”¶å­é¡¹åç§°çš„ç¼“å†²åŒºã€‚
* `&len`ï¼šè¾“å…¥è¾“å‡ºå‚æ•°ï¼Œè¾“å…¥ä¸ºç¼“å†²åŒºå¤§å°ï¼Œè¾“å‡ºä¸ºå­é¡¹åç§°é•¿åº¦ã€‚

### è¾“å‡º

```
æšä¸¾æ‰€æœ‰å­é¡¹åç§°ï¼šsubKey
```

---

## 4. RegEnumValue - æšä¸¾é”®å€¼å

* ğŸ“š [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regenumvaluew)

```cpp
WCHAR valueName[256];
BYTE data[256];
DWORD nameLen = 256, dataLen = 256, type;
RegEnumValueW(hKey, index, valueName, &nameLen, NULL, &type, data, &dataLen);
```

### å‚æ•°è¯´æ˜

* `hKey`ï¼šåŒ…å«å€¼çš„æ³¨å†Œè¡¨é”®å¥æŸ„ã€‚
* `index`ï¼šè¦æšä¸¾çš„å€¼çš„ç´¢å¼•ï¼ˆä» 0 å¼€å§‹ï¼‰ã€‚
* `valueName`ï¼šç”¨äºæ¥æ”¶å€¼åçš„ç¼“å†²åŒºã€‚
* `&nameLen`ï¼šè¾“å…¥ï¼švalueName ç¼“å†²åŒºå¤§å°ï¼›è¾“å‡ºï¼šå®é™…åç§°é•¿åº¦ï¼ˆä¸å« null terminatorï¼‰ã€‚
* `NULL`ï¼šä¿ç•™ï¼Œå¿…é¡»ä¸º NULLã€‚
* `&type`ï¼šè¿”å›å€¼çš„ç±»å‹ï¼ˆå¦‚ REG\_SZ, REG\_DWORD ç­‰ï¼‰ã€‚
* `data`ï¼šæ¥æ”¶å€¼æ•°æ®çš„ç¼“å†²åŒºã€‚
* `&dataLen`ï¼šè¾“å…¥ï¼šdata ç¼“å†²åŒºå¤§å°ï¼›è¾“å‡ºï¼šå®é™…å†™å…¥çš„æ•°æ®é•¿åº¦ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰ã€‚

### ç¤ºä¾‹è¾“å‡º

```
å€¼åç§°: valueName
ç±»å‹: type
æ•°æ®: dataï¼ˆå­—ç¬¦ä¸²æˆ–åå…­è¿›åˆ¶ï¼‰
```

---

## 5. RegSetValueEx - è®¾ç½®é”®å€¼æ•°æ®

* ğŸ“š [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regsetvalueexw)

```cpp
const wchar_t* data = L"æµ‹è¯•";
RegSetValueExW(hKey, L"KeyName", 0, REG_SZ, (const BYTE*)data, (wcslen(data)+1)*sizeof(wchar_t));
```

### å‚æ•°è¯´æ˜

* `hKey`ï¼šç›®æ ‡é”®å¥æŸ„ã€‚
* `L"KeyName"`ï¼šè¦è®¾ç½®çš„å€¼åç§°ã€‚
* `0`ï¼šä¿ç•™ï¼Œå¿…é¡»ä¸º 0ã€‚
* `REG_SZ`ï¼šæ•°æ®ç±»å‹ï¼Œæ­¤å¤„ä¸ºå­—ç¬¦ä¸²ã€‚
* `data`ï¼šè¦è®¾ç½®çš„å®é™…æ•°æ®ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰ã€‚
* `æ•°æ®é•¿åº¦`ï¼šå•ä½ä¸ºå­—èŠ‚ï¼Œå¯¹ REG\_SZ ç±»å‹ä¸º `(wcslen+1)*sizeof(wchar_t)`ã€‚

---

## 6. RegQueryValueEx - è¯»å–é”®å€¼æ•°æ®

* ğŸ“š [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regqueryvalueexw)

```cpp
BYTE buffer[256];
DWORD len = sizeof(buffer), type;
RegQueryValueExW(hKey, L"KeyName", NULL, &type, buffer, &len);
```

### å‚æ•°è¯´æ˜

* `hKey`ï¼šç›®æ ‡é”®å¥æŸ„ã€‚
* `L"KeyName"`ï¼šè¦è¯»å–çš„å€¼åç§°ã€‚
* `NULL`ï¼šä¿ç•™ã€‚
* `&type`ï¼šè¿”å›å€¼ç±»å‹ï¼ˆå¦‚ REG\_SZã€REG\_DWORDï¼‰ã€‚
* `buffer`ï¼šæ¥æ”¶å€¼æ•°æ®çš„ç¼“å†²åŒºã€‚
* `&len`ï¼šè¾“å…¥ç¼“å†²åŒºå¤§å°ï¼Œè¾“å‡ºå®é™…å†™å…¥å¤§å°ã€‚

---

## 7. RegDeleteValue - åˆ é™¤é”®å€¼

* ğŸ“š [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regdeletevaluew)

```cpp
RegDeleteValueW(hKey, L"KeyName");
```

### å‚æ•°è¯´æ˜

* `hKey`ï¼šåŒ…å«è¦åˆ é™¤å€¼çš„é”®å¥æŸ„ã€‚
* `L"KeyName"`ï¼šè¦åˆ é™¤çš„å€¼åç§°ã€‚

---

## 8. RegDeleteKeyEx - åˆ é™¤å­é¡¹

* ğŸ“š [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regdeletekeyexw)

```cpp
RegDeleteKeyExW(HKEY_CURRENT_USER, L"Software\\MyApp", KEY_WOW64_64KEY, 0);
```

### å‚æ•°è¯´æ˜

* `HKEY_CURRENT_USER`ï¼šæ ¹é”®ã€‚
* `L"Software\\MyApp"`ï¼šè¦åˆ é™¤çš„å­é¡¹ã€‚
* `KEY_WOW64_64KEY`ï¼šå¹³å°æ ‡å¿—ã€‚
* `0`ï¼šä¿ç•™ï¼Œå¿…é¡»ä¸º 0ã€‚

---

## 9. RegCloseKey - å…³é—­æ³¨å†Œè¡¨é”®å¥æŸ„

* ğŸ“š [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regclosekey)

```cpp
RegCloseKey(hKey);
```

### å‚æ•°è¯´æ˜

* `hKey`ï¼šè¦å…³é—­çš„æ³¨å†Œè¡¨é”®å¥æŸ„ã€‚

---

## 10. RegQueryInfoKeyW - è·å–æ³¨å†Œè¡¨é”®ä¿¡æ¯

* ğŸ“š [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regqueryinfokeyw)

```cpp
DWORD valueCount = 0, maxValueNameLen = 0, maxValueLen = 0;
RegQueryInfoKeyW(hKey, NULL, NULL, NULL, NULL, NULL, NULL, &valueCount, &maxValueNameLen, &maxValueLen, NULL, NULL);
```

### å‚æ•°è¯´æ˜

* `hKey`ï¼šè¦æŸ¥è¯¢ä¿¡æ¯çš„é”®å¥æŸ„ã€‚
* `&valueCount`ï¼šè¿”å›å€¼çš„æ•°é‡ã€‚
* `&maxValueNameLen`ï¼šè¿”å›æœ€é•¿å€¼åçš„å­—ç¬¦æ•°ï¼ˆä¸å« nullï¼‰ã€‚
* `&maxValueLen`ï¼šè¿”å›æœ€å¤§æ•°æ®å­—èŠ‚é•¿åº¦ã€‚

### ç¤ºä¾‹è¾“å‡º

```
å€¼æ•°é‡: valueCount
æœ€å¤§å€¼åé•¿åº¦: maxValueNameLen
æœ€å¤§æ•°æ®é•¿åº¦: maxValueLen
```

---

å¦‚éœ€å¸¦è‡ªåŠ¨é”™è¯¯æ£€æµ‹ã€åŠ¨æ€ç¼“å†²å®‰å…¨ç¤ºä¾‹ï¼Œå¯ç»§ç»­è¯·æ±‚æ‰©å±•æ¨¡æ¿ã€‚
