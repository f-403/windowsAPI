# Windows 注册表 API 中文文档（含参数说明、示例、是否支持两次调用）

## 📚 目录

1. [RegCreateKeyEx - 创建或打开注册表键](#regcreatekeyex)
2. [RegOpenKeyEx - 打开已有注册表键](#regopenkeyex)
3. [RegEnumKeyEx - 枚举子项](#regenumkeyex)
4. [RegEnumValue - 枚举键值名](#regenumvalue)
5. [RegSetValueEx - 设置键值数据](#regsetvalueex)
6. [RegQueryValueEx - 读取键值数据](#regqueryvalueex)
7. [RegDeleteValue - 删除键值](#regdeletevalue)
8. [RegDeleteKeyEx - 删除子项](#regdeletekeyex)
9. [RegCloseKey - 关闭注册表键句柄](#regclosekey)
10. [RegQueryInfoKeyW - 获取注册表键信息](#regqueryinfokeyw)

---

## 1. RegCreateKeyEx - 创建或打开注册表键

### 📌 功能

创建一个新的注册表子项，或打开已存在的子项。

### 📥 参数说明

| 参数名                  | 类型                     | 说明                            |
| -------------------- | ---------------------- | ----------------------------- |
| hKey                 | HKEY                   | 父项句柄                          |
| lpSubKey             | LPCWSTR                | 子项名称                          |
| Reserved             | DWORD                  | 保留，必须为0                       |
| lpClass              | LPWSTR                 | 类名，可为 NULL                    |
| dwOptions            | DWORD                  | 一般为 `REG_OPTION_NON_VOLATILE` |
| samDesired           | REGSAM                 | 权限访问掩码                        |
| lpSecurityAttributes | LPSECURITY\_ATTRIBUTES | 可为 NULL                       |
| phkResult            | PHKEY                  | 输出，新项句柄                       |
| lpdwDisposition      | LPDWORD                | 输出，指示创建或打开                    |

### 🔁 是否支持分两次调用获取长度

**否** ❌

### 💻 示例

```cpp
HKEY hKey;
RegCreateKeyExW(HKEY_CURRENT_USER, L"Software\\MyApp", 0, NULL, 0, KEY_WRITE, NULL, &hKey, NULL);
```

---

## 2. RegOpenKeyEx - 打开已有注册表键

### 📌 功能

打开一个已存在的注册表子项。

### 📥 参数说明

| 参数名        | 类型      | 说明       |
| ---------- | ------- | -------- |
| hKey       | HKEY    | 父项句柄     |
| lpSubKey   | LPCWSTR | 子项名称     |
| ulOptions  | DWORD   | 保留，必须为0  |
| samDesired | REGSAM  | 权限访问掩码   |
| phkResult  | PHKEY   | 输出，返回项句柄 |

### 🔁 是否支持分两次调用获取长度

**否** ❌

### 💻 示例

```cpp
HKEY hKey;
RegOpenKeyExW(HKEY_LOCAL_MACHINE, L"SOFTWARE\\Microsoft", 0, KEY_READ, &hKey);
```

---

## 3. RegEnumKeyEx - 枚举子项

### 📌 功能

枚举注册表键下的子项名称。

### 📥 参数说明

| 参数名               | 类型        | 说明               |
| ----------------- | --------- | ---------------- |
| hKey              | HKEY      | 要枚举的主键           |
| dwIndex           | DWORD     | 从 0 开始的索引        |
| lpName            | LPWSTR    | 输出缓冲区（不能为 NULL）  |
| lpcName           | LPDWORD   | 输入：缓冲区大小，输出：实际长度 |
| lpReserved        | LPDWORD   | 保留，必须为 NULL      |
| lpClass           | LPWSTR    | 类名缓冲区，可为 NULL    |
| lpcClass          | LPDWORD   | 类名长度指针，可为 NULL   |
| lpftLastWriteTime | PFILETIME | 可为 NULL          |

### 🔁 是否支持分两次调用获取长度

**否** ❌（必须预先准备缓冲区）

### 💻 示例

```cpp
DWORD nameLen = 256;
WCHAR name[256];
RegEnumKeyExW(hKey, 0, name, &nameLen, NULL, NULL, NULL, NULL);
```

---

## 4. RegEnumValue - 枚举键值名

### 📌 功能

枚举指定注册表键的所有键值名。

### 📥 参数说明

| 参数名            | 类型      | 说明               |
| -------------- | ------- | ---------------- |
| hKey           | HKEY    | 键句柄              |
| dwIndex        | DWORD   | 键值索引             |
| lpValueName    | LPWSTR  | 名称缓冲区（不能为 NULL）  |
| lpcchValueName | LPDWORD | 输入：缓冲区长度，输出：实际长度 |
| lpReserved     | LPDWORD | 保留，必须为 NULL      |
| lpType         | LPDWORD | 输出值类型，可为 NULL    |
| lpData         | LPBYTE  | 数据缓冲区            |
| lpcbData       | LPDWORD | 数据长度指针           |

### 🔁 是否支持分两次调用获取长度

**部分支持** ⚠️（不能传 NULL，但可先用小缓冲触发 ERROR\_MORE\_DATA）

### 💻 示例

```cpp
DWORD nameLen = 1, dataLen = 1;
WCHAR dummyName[1]; BYTE dummyData[1];
LONG res = RegEnumValueW(hKey, 0, dummyName, &nameLen, NULL, NULL, dummyData, &dataLen);
if (res == ERROR_MORE_DATA) {
  // nameLen 和 dataLen 即为实际长度
}
```

---

## 5. RegSetValueEx - 设置键值数据

### 📌 功能

设置或更新注册表项中的键值数据。

### 📥 参数说明

| 参数名         | 类型           | 说明             |
| ----------- | ------------ | -------------- |
| hKey        | HKEY         | 注册表键句柄         |
| lpValueName | LPCWSTR      | 值名称            |
| Reserved    | DWORD        | 保留，必须为 0       |
| dwType      | DWORD        | 数据类型，如 REG\_SZ |
| lpData      | const BYTE\* | 数据指针           |
| cbData      | DWORD        | 数据大小（字节）       |

### 🔁 是否支持分两次调用获取长度

**否** ❌

### 💻 示例

```cpp
const wchar_t* data = L"Test";
RegSetValueExW(hKey, L"MyValue", 0, REG_SZ, (const BYTE*)data, (wcslen(data) + 1) * sizeof(wchar_t));
```

---

## 6. RegQueryValueEx - 读取键值数据

### 📌 功能

读取指定键值的数据。

### 📥 参数说明

| 参数名         | 类型      | 说明              |
| ----------- | ------- | --------------- |
| hKey        | HKEY    | 注册表键句柄          |
| lpValueName | LPCWSTR | 值名称             |
| lpReserved  | LPDWORD | 必须为 NULL        |
| lpType      | LPDWORD | 返回类型（如 REG\_SZ） |
| lpData      | LPBYTE  | 数据缓冲区（可为 NULL）  |
| lpcbData    | LPDWORD | 输入/输出：长度        |

### 🔁 是否支持分两次调用获取长度

**支持** ✅（第一次传 NULL 获取长度）

### 💻 示例

```cpp
DWORD dataLen = 0;
RegQueryValueExW(hKey, L"MyValue", NULL, NULL, NULL, &dataLen);
BYTE* buffer = new BYTE[dataLen];
RegQueryValueExW(hKey, L"MyValue", NULL, NULL, buffer, &dataLen);
```

---

## 7. RegDeleteValue - 删除键值

### 📌 功能

删除指定注册表项的值。

### 📥 参数说明

| 参数名         | 类型      | 说明      |
| ----------- | ------- | ------- |
| hKey        | HKEY    | 键句柄     |
| lpValueName | LPCWSTR | 要删除的键值名 |

### 🔁 是否支持分两次调用获取长度

**不适用** ❌

### 💻 示例

```cpp
RegDeleteValueW(hKey, L"MyValue");
```

---

## 8. RegDeleteKeyEx - 删除子项

### 📌 功能

删除注册表子项。

### 📥 参数说明

| 参数名        | 类型      | 说明       |
| ---------- | ------- | -------- |
| hKey       | HKEY    | 父项句柄     |
| lpSubKey   | LPCWSTR | 子项路径     |
| samDesired | REGSAM  | 权限标志     |
| Reserved   | DWORD   | 保留，必须为 0 |

### 🔁 是否支持分两次调用获取长度

**不适用** ❌

### 💻 示例

```cpp
RegDeleteKeyExW(hKey, L"MySubKey", KEY_WOW64_64KEY, 0);
```

---

## 9. RegCloseKey - 关闭注册表键句柄

### 📌 功能

关闭指定的注册表键。

### 📥 参数说明

| 参数名  | 类型   | 说明     |
| ---- | ---- | ------ |
| hKey | HKEY | 要关闭的句柄 |

### 🔁 是否支持分两次调用获取长度

**不适用** ❌

### 💻 示例

```cpp
RegCloseKey(hKey);
```

---

## 10. RegQueryInfoKeyW - 获取注册表键信息

### 📌 功能

获取注册表键的详细信息，包括子键数量、最大长度等。

### 📥 参数说明

| 参数名                    | 类型        | 说明              |
| ---------------------- | --------- | --------------- |
| hKey                   | HKEY      | 已打开的注册表键句柄      |
| lpClass                | LPWSTR    | 类名缓冲区，可为 NULL   |
| lpcClass               | LPDWORD   | 类名长度，可为 NULL    |
| lpReserved             | LPDWORD   | 保留，必须为 NULL     |
| lpcSubKeys             | LPDWORD   | 子键数量输出，可为 NULL  |
| lpcbMaxSubKeyLen       | LPDWORD   | 最长子键长度，可为 NULL  |
| lpcbMaxClassLen        | LPDWORD   | 最长类名长度，可为 NULL  |
| lpcValues              | LPDWORD   | 值数量，可为 NULL     |
| lpcbMaxValueNameLen    | LPDWORD   | 最长值名称长度，可为 NULL |
| lpcbMaxValueLen        | LPDWORD   | 最大数据长度，可为 NULL  |
| lpcbSecurityDescriptor | LPDWORD   | 安全描述符大小，可为 NULL |
| lpftLastWriteTime      | PFILETIME | 最后写入时间，可为 NULL  |

### 🔁 是否支持分两次调用获取长度

**支持** ✅（可以只填写需要的字段）

### 💻 示例

```cpp
DWORD subKeys = 0, maxLen = 0;
RegQueryInfoKeyW(hKey, NULL, NULL, NULL, &subKeys, &maxLen, NULL, NULL, NULL, NULL, NULL, NULL);
```

---
