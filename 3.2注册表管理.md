# Windows 注册表 API 操作文档（含函数说明、参数详解与示例）

## 📑 目录

1. [RegCreateKeyEx - 创建或打开注册表键](#regcreatekeyex)
2. [RegOpenKeyEx - 打开已有注册表键](#regopenkeyex)
3. [RegEnumKeyEx - 枚举子项](#regenumkeyex)
4. [RegEnumValue - 枚举键值名](#regenumvalue)
5. [RegSetValueEx - 设置键值数据](#regsetvalueex)
6. [RegQueryValueEx - 读取键值数据](#regqueryvalueex)
7. [RegDeleteValue - 删除键值](#regdeletevalue)
8. [RegDeleteKeyEx - 删除子项](#regdeletekeyex)
9. [RegCloseKey - 关闭注册表键句柄](#regclosekey)
---

## 📘 RegCreateKeyEx

**功能说明：** 创建或打开指定的注册表子项。

**函数原型：**

```cpp
LSTATUS RegCreateKeyEx(
  HKEY                  hKey,
  LPCWSTR               lpSubKey,
  DWORD                 Reserved,
  LPWSTR                lpClass,
  DWORD                 dwOptions,
  REGSAM                samDesired,
  LPSECURITY_ATTRIBUTES lpSecurityAttributes,
  PHKEY                 phkResult,
  LPDWORD               lpdwDisposition
);
```

**参数说明（简化）：**

- `hKey`：主键，如 `HKEY_CURRENT_USER`
- `lpSubKey`：要创建/打开的子键路径
- `samDesired`：访问权限，如 `KEY_ALL_ACCESS`
- `phkResult`：返回键句柄
- `lpdwDisposition`：返回是否新建 (`REG_CREATED_NEW_KEY`) 或已存在 (`REG_OPENED_EXISTING_KEY`)

**示例：**

```cpp
HKEY hKey;
DWORD dw;
LONG ret = RegCreateKeyEx(HKEY_CURRENT_USER, L"Software\NewKey", 0, NULL, 0, KEY_ALL_ACCESS, NULL, &hKey, &dw);
if (ret == ERROR_SUCCESS) {
    wprintf(L"创建/打开成功: %s
", dw == REG_CREATED_NEW_KEY ? L"新建" : L"已存在");
    RegCloseKey(hKey);
}
```

**输出示例：**

```
创建/打开成功: 新建
```

🔗 [MSDN 文档](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regcreatekeyexw)

---

## 📘 RegOpenKeyEx

**功能说明：** 打开一个已存在的注册表键。

**函数原型：**

```cpp
LSTATUS RegOpenKeyEx(
  HKEY    hKey,
  LPCWSTR lpSubKey,
  DWORD   ulOptions,
  REGSAM  samDesired,
  PHKEY   phkResult
);
```

**参数说明：**

- `hKey`：根键，如 `HKEY_CURRENT_USER`
- `lpSubKey`：要打开的子键路径
- `ulOptions`：保留，必须为 0
- `samDesired`：访问权限（如 `KEY_READ`, `KEY_WRITE`）
- `phkResult`：成功后返回打开的键句柄

**示例：**

```cpp
HKEY hKey;
LONG ret = RegOpenKeyEx(HKEY_CURRENT_USER, L"Software\\TestKey", 0, KEY_READ, &hKey);
if (ret == ERROR_SUCCESS) {
    wprintf(L"打开成功\n");
    RegCloseKey(hKey);
} else {
    wprintf(L"打开失败，错误码：%ld\n", ret);
}
```

**输出示例：**

```
打开成功
```

🔗 [MSDN 文档](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regopenkeyexw)

---

## 📘 RegEnumKeyEx

**功能说明：** 枚举指定注册表项的子项。

**函数原型：**

```cpp
LSTATUS RegEnumKeyEx(
  HKEY      hKey,
  DWORD     dwIndex,
  LPWSTR    lpName,
  LPDWORD   lpcName,
  LPDWORD   lpReserved,
  LPWSTR    lpClass,
  LPDWORD   lpcClass,
  PFILETIME lpftLastWriteTime
);
```

**参数说明：**

- `hKey`：已打开的主键句柄
- `dwIndex`：从 0 开始的索引
- `lpName`：接收子键名的缓冲区
- `lpcName`：`lpName` 缓冲区大小
- `lpClass`/`lpcClass`：可为 NULL
- `lpftLastWriteTime`：可为 NULL

**示例：**

```cpp
DWORD index = 0;
WCHAR subKeyName[256];
DWORD size = 256;
while (RegEnumKeyEx(hKey, index++, subKeyName, &size, NULL, NULL, NULL, NULL) == ERROR_SUCCESS) {
    wprintf(L"子项: %s\n", subKeyName);
    size = 256;
}
```

**输出示例：**

```
子项: SubKey1
子项: SubKey2
```

🔗 [MSDN 文档](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regenumkeyexw)

---



## 📘 RegEnumValue

**功能说明：** 枚举指定注册表项下的值名和值类型。

**示例：**

```cpp
DWORD index = 0;
WCHAR valueName[256];
DWORD valueNameSize = 256;
DWORD type;
BYTE data[256];
DWORD dataSize = sizeof(data);
while (RegEnumValue(hKey, index++, valueName, &valueNameSize, NULL, &type, data, &dataSize) == ERROR_SUCCESS) {
    wprintf(L"值名: %s 类型: %d\n", valueName, type);
    valueNameSize = 256;
    dataSize = sizeof(data);
}
```

**输出示例：**

```
值名: Setting 类型: 1
```

🔗 [MSDN 文档](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regenumvaluew)

---

## 📘 RegSetValueEx

**功能说明：** 设置指定名称的值。

**示例：**

```cpp
const wchar_t* data = L"Hello";
RegSetValueEx(hKey, L"MyValue", 0, REG_SZ, (const BYTE*)data, (wcslen(data) + 1) * sizeof(wchar_t));
```

**输出示例：**

```
值已设置成功
```

🔗 [MSDN 文档](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regsetvalueexw)

---

## 📘 RegQueryValueEx

**功能说明：** 查询指定值的内容。

**示例：**

```cpp
WCHAR buffer[256];
DWORD size = sizeof(buffer);
DWORD type;
RegQueryValueEx(hKey, L"MyValue", NULL, &type, (LPBYTE)buffer, &size);
if (type == REG_SZ) {
    wprintf(L"读取到的字符串: %s\n", buffer);
}
```

**输出示例：**

```
读取到的字符串: Hello
```

🔗 [MSDN 文档](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regqueryvalueexw)

---

## 📘 RegDeleteValue

**功能说明：** 删除指定值名。

**示例：**

```cpp
RegDeleteValue(hKey, L"MyValue");
```

**输出示例：**

```
值删除成功
```

🔗 [MSDN 文档](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regdeletevaluew)

---

## 📘 RegDeleteKeyEx

**功能说明：** 删除注册表子项及其值。

**示例：**

```cpp
RegDeleteKeyEx(HKEY_CURRENT_USER, L"Software\\NewKey", KEY_WOW64_64KEY, 0);
```

**输出示例：**

```
子键删除成功
```

🔗 [MSDN 文档](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regdeletekeyexw)

---

## 📘 RegCloseKey

**功能说明：** 关闭一个注册表键句柄。

**函数原型：**

```cpp
LSTATUS RegCloseKey(
  HKEY hKey
);
```

**示例：**

```cpp
RegCloseKey(hKey);
```

**输出示例：**

```
句柄关闭成功
```

🔗 [MSDN 文档](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regclosekey)

