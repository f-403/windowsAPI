# Windows æ³¨å†Œè¡¨ API æ“ä½œæ–‡æ¡£ï¼ˆå«å‡½æ•°è¯´æ˜ã€å‚æ•°è¯¦è§£ä¸ç¤ºä¾‹ï¼‰

## ğŸ“‘ ç›®å½•

1. [RegCreateKeyEx - åˆ›å»ºæˆ–æ‰“å¼€æ³¨å†Œè¡¨é”®](#regcreatekeyex)
2. [RegOpenKeyEx - æ‰“å¼€å·²æœ‰æ³¨å†Œè¡¨é”®](#regopenkeyex)
3. [RegEnumKeyEx - æšä¸¾å­é¡¹](#regenumkeyex)
4. [RegEnumValue - æšä¸¾é”®å€¼å](#regenumvalue)
5. [RegSetValueEx - è®¾ç½®é”®å€¼æ•°æ®](#regsetvalueex)
6. [RegQueryValueEx - è¯»å–é”®å€¼æ•°æ®](#regqueryvalueex)
7. [RegDeleteValue - åˆ é™¤é”®å€¼](#regdeletevalue)
8. [RegDeleteKeyEx - åˆ é™¤å­é¡¹](#regdeletekeyex)
9. [RegCloseKey - å…³é—­æ³¨å†Œè¡¨é”®å¥æŸ„](#regclosekey)
---

## ğŸ“˜ RegCreateKeyEx

**åŠŸèƒ½è¯´æ˜ï¼š** åˆ›å»ºæˆ–æ‰“å¼€æŒ‡å®šçš„æ³¨å†Œè¡¨å­é¡¹ã€‚

**å‡½æ•°åŸå‹ï¼š**

```cpp
LSTATUS RegCreateKeyEx(
  HKEY                  hKey,
  LPCWSTR               lpSubKey,
  DWORD                 Reserved,
  LPWSTR                lpClass,
  DWORD                 dwOptions,
  REGSAM                samDesired,
  LPSECURITY_ATTRIBUTES lpSecurityAttributes,
  PHKEY                 phkResult,
  LPDWORD               lpdwDisposition
);
```

**å‚æ•°è¯´æ˜ï¼ˆç®€åŒ–ï¼‰ï¼š**

- `hKey`ï¼šä¸»é”®ï¼Œå¦‚ `HKEY_CURRENT_USER`
- `lpSubKey`ï¼šè¦åˆ›å»º/æ‰“å¼€çš„å­é”®è·¯å¾„
- `samDesired`ï¼šè®¿é—®æƒé™ï¼Œå¦‚ `KEY_ALL_ACCESS`
- `phkResult`ï¼šè¿”å›é”®å¥æŸ„
- `lpdwDisposition`ï¼šè¿”å›æ˜¯å¦æ–°å»º (`REG_CREATED_NEW_KEY`) æˆ–å·²å­˜åœ¨ (`REG_OPENED_EXISTING_KEY`)

**ç¤ºä¾‹ï¼š**

```cpp
HKEY hKey;
DWORD dw;
LONG ret = RegCreateKeyEx(HKEY_CURRENT_USER, L"Software\NewKey", 0, NULL, 0, KEY_ALL_ACCESS, NULL, &hKey, &dw);
if (ret == ERROR_SUCCESS) {
    wprintf(L"åˆ›å»º/æ‰“å¼€æˆåŠŸ: %s
", dw == REG_CREATED_NEW_KEY ? L"æ–°å»º" : L"å·²å­˜åœ¨");
    RegCloseKey(hKey);
}
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
åˆ›å»º/æ‰“å¼€æˆåŠŸ: æ–°å»º
```

ğŸ”— [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regcreatekeyexw)

---

## ğŸ“˜ RegOpenKeyEx

**åŠŸèƒ½è¯´æ˜ï¼š** æ‰“å¼€ä¸€ä¸ªå·²å­˜åœ¨çš„æ³¨å†Œè¡¨é”®ã€‚

**å‡½æ•°åŸå‹ï¼š**

```cpp
LSTATUS RegOpenKeyEx(
  HKEY    hKey,
  LPCWSTR lpSubKey,
  DWORD   ulOptions,
  REGSAM  samDesired,
  PHKEY   phkResult
);
```

**å‚æ•°è¯´æ˜ï¼š**

- `hKey`ï¼šæ ¹é”®ï¼Œå¦‚ `HKEY_CURRENT_USER`
- `lpSubKey`ï¼šè¦æ‰“å¼€çš„å­é”®è·¯å¾„
- `ulOptions`ï¼šä¿ç•™ï¼Œå¿…é¡»ä¸º 0
- `samDesired`ï¼šè®¿é—®æƒé™ï¼ˆå¦‚ `KEY_READ`, `KEY_WRITE`ï¼‰
- `phkResult`ï¼šæˆåŠŸåè¿”å›æ‰“å¼€çš„é”®å¥æŸ„

**ç¤ºä¾‹ï¼š**

```cpp
HKEY hKey;
LONG ret = RegOpenKeyEx(HKEY_CURRENT_USER, L"Software\\TestKey", 0, KEY_READ, &hKey);
if (ret == ERROR_SUCCESS) {
    wprintf(L"æ‰“å¼€æˆåŠŸ\n");
    RegCloseKey(hKey);
} else {
    wprintf(L"æ‰“å¼€å¤±è´¥ï¼Œé”™è¯¯ç ï¼š%ld\n", ret);
}
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
æ‰“å¼€æˆåŠŸ
```

ğŸ”— [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regopenkeyexw)

---

## ğŸ“˜ RegEnumKeyEx

**åŠŸèƒ½è¯´æ˜ï¼š** æšä¸¾æŒ‡å®šæ³¨å†Œè¡¨é¡¹çš„å­é¡¹ã€‚

**å‡½æ•°åŸå‹ï¼š**

```cpp
LSTATUS RegEnumKeyEx(
  HKEY      hKey,
  DWORD     dwIndex,
  LPWSTR    lpName,
  LPDWORD   lpcName,
  LPDWORD   lpReserved,
  LPWSTR    lpClass,
  LPDWORD   lpcClass,
  PFILETIME lpftLastWriteTime
);
```

**å‚æ•°è¯´æ˜ï¼š**

- `hKey`ï¼šå·²æ‰“å¼€çš„ä¸»é”®å¥æŸ„
- `dwIndex`ï¼šä» 0 å¼€å§‹çš„ç´¢å¼•
- `lpName`ï¼šæ¥æ”¶å­é”®åçš„ç¼“å†²åŒº
- `lpcName`ï¼š`lpName` ç¼“å†²åŒºå¤§å°
- `lpClass`/`lpcClass`ï¼šå¯ä¸º NULL
- `lpftLastWriteTime`ï¼šå¯ä¸º NULL

**ç¤ºä¾‹ï¼š**

```cpp
DWORD index = 0;
WCHAR subKeyName[256];
DWORD size = 256;
while (RegEnumKeyEx(hKey, index++, subKeyName, &size, NULL, NULL, NULL, NULL) == ERROR_SUCCESS) {
    wprintf(L"å­é¡¹: %s\n", subKeyName);
    size = 256;
}
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
å­é¡¹: SubKey1
å­é¡¹: SubKey2
```

ğŸ”— [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regenumkeyexw)

---



## ğŸ“˜ RegEnumValue

**åŠŸèƒ½è¯´æ˜ï¼š** æšä¸¾æŒ‡å®šæ³¨å†Œè¡¨é¡¹ä¸‹çš„å€¼åå’Œå€¼ç±»å‹ã€‚

**ç¤ºä¾‹ï¼š**

```cpp
DWORD index = 0;
WCHAR valueName[256];
DWORD valueNameSize = 256;
DWORD type;
BYTE data[256];
DWORD dataSize = sizeof(data);
while (RegEnumValue(hKey, index++, valueName, &valueNameSize, NULL, &type, data, &dataSize) == ERROR_SUCCESS) {
    wprintf(L"å€¼å: %s ç±»å‹: %d\n", valueName, type);
    valueNameSize = 256;
    dataSize = sizeof(data);
}
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
å€¼å: Setting ç±»å‹: 1
```

ğŸ”— [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regenumvaluew)

---

## ğŸ“˜ RegSetValueEx

**åŠŸèƒ½è¯´æ˜ï¼š** è®¾ç½®æŒ‡å®šåç§°çš„å€¼ã€‚

**ç¤ºä¾‹ï¼š**

```cpp
const wchar_t* data = L"Hello";
RegSetValueEx(hKey, L"MyValue", 0, REG_SZ, (const BYTE*)data, (wcslen(data) + 1) * sizeof(wchar_t));
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
å€¼å·²è®¾ç½®æˆåŠŸ
```

ğŸ”— [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regsetvalueexw)

---

## ğŸ“˜ RegQueryValueEx

**åŠŸèƒ½è¯´æ˜ï¼š** æŸ¥è¯¢æŒ‡å®šå€¼çš„å†…å®¹ã€‚

**ç¤ºä¾‹ï¼š**

```cpp
WCHAR buffer[256];
DWORD size = sizeof(buffer);
DWORD type;
RegQueryValueEx(hKey, L"MyValue", NULL, &type, (LPBYTE)buffer, &size);
if (type == REG_SZ) {
    wprintf(L"è¯»å–åˆ°çš„å­—ç¬¦ä¸²: %s\n", buffer);
}
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
è¯»å–åˆ°çš„å­—ç¬¦ä¸²: Hello
```

ğŸ”— [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regqueryvalueexw)

---

## ğŸ“˜ RegDeleteValue

**åŠŸèƒ½è¯´æ˜ï¼š** åˆ é™¤æŒ‡å®šå€¼åã€‚

**ç¤ºä¾‹ï¼š**

```cpp
RegDeleteValue(hKey, L"MyValue");
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
å€¼åˆ é™¤æˆåŠŸ
```

ğŸ”— [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regdeletevaluew)

---

## ğŸ“˜ RegDeleteKeyEx

**åŠŸèƒ½è¯´æ˜ï¼š** åˆ é™¤æ³¨å†Œè¡¨å­é¡¹åŠå…¶å€¼ã€‚

**ç¤ºä¾‹ï¼š**

```cpp
RegDeleteKeyEx(HKEY_CURRENT_USER, L"Software\\NewKey", KEY_WOW64_64KEY, 0);
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
å­é”®åˆ é™¤æˆåŠŸ
```

ğŸ”— [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regdeletekeyexw)

---

## ğŸ“˜ RegCloseKey

**åŠŸèƒ½è¯´æ˜ï¼š** å…³é—­ä¸€ä¸ªæ³¨å†Œè¡¨é”®å¥æŸ„ã€‚

**å‡½æ•°åŸå‹ï¼š**

```cpp
LSTATUS RegCloseKey(
  HKEY hKey
);
```

**ç¤ºä¾‹ï¼š**

```cpp
RegCloseKey(hKey);
```

**è¾“å‡ºç¤ºä¾‹ï¼š**

```
å¥æŸ„å…³é—­æˆåŠŸ
```

ğŸ”— [MSDN æ–‡æ¡£](https://learn.microsoft.com/zh-cn/windows/win32/api/winreg/nf-winreg-regclosekey)

